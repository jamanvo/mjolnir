<!DOCTYPE html>
<html lang="en">
<head>
    <title>API Call Test</title>
    <link href="static/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/basic.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="static/js/bootstrap.min.js"></script>
</head>

<body>
    <div class="header col-md-10-">
        <h1 class="header-title">API Response Checker</h1>
    </div>
    <div class="container col-md-12">
        <div class="input-area">
            <div class="url col-md-12">
                <input type="text" class="url-input col-md-9 pull-left" id="url" placeholder="Insert URL to Test">
                <button type="submit" class="btn btn-default col-md-2 pull-right" onclick="sendRequest()">전송</button>
            </div>
            <div class="message col-md-12"></div>
        </div>
        <div class="json-container col-md-12">
            <div class="json-box pull-left">
                <div class="json-title col-md-12">API Arguments</div>
                <textarea class="json-area col-md-12" id="args" placeholder="Insert JSON arguments"></textarea>
            </div>
            <div class="json-box pull-left">
                <div class="json-title col-md-12">Control Group</div>
                <textarea class="json-area col-md-12" id="ctrl-group" placeholder="Insert JSON to comparison"></textarea>
            </div>
        </div>
        <div class="compare-result col-md-12">
            <textarea class="json-area col-md-12" id="result" placeholder="Compare Result"></textarea>
        </div>
    </div>
</body>
</html>

<script>
    function sendRequest() {
        let ctrlGroup = $("#ctrl-group").val();
        let callURL = $("#url").val();
        let args = $("#args").val();
        let url = '/smash';

        checkParams(ctrlGroup, args);

        let params = {
            ctrl_group: ctrlGroup,
            args: args,
            url: callURL
        };

        $.ajax({
            type: 'POST',
            url: url,
            data: params,
            dataType: 'json'
        })
            .done()
            .fail()
    }

    function checkParams(ctrlGroup, args) {
        if (!IsJsonString(ctrlGroup) || ctrlGroup === '') {
            alert("Control Group could not parse to JSON");
            return
        }

        if (!IsJsonString(args) || args === '') {
            alert("API Arguments could not parse to JSON");
        }
    }

    function IsJsonString(str) {
    try {
        JSON.parse(str);
    } catch (e) {
        return false
    }
    return true
}
</script>